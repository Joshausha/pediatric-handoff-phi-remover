---
phase: 09-cicd-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - tests/sample_transcripts.py
  - requirements-dev.txt
autonomous: true

must_haves:
  truths:
    - "pip install -r requirements.txt succeeds without errors"
    - "pip install -r requirements-dev.txt succeeds without errors"
    - "pytest tests/ passes all tests with 0 failures"
  artifacts:
    - path: "tests/sample_transcripts.py"
      provides: "Test data with v1.0-aligned expectations"
      contains: "Ronald McDonald House"
    - path: "requirements-dev.txt"
      provides: "Development dependencies (committed)"
      min_lines: 5
  key_links:
    - from: "tests/test_deidentification.py"
      to: "tests/sample_transcripts.py"
      via: "import SAMPLE_TRANSCRIPTS, EXPECTED_OUTPUTS"
      pattern: "from tests.sample_transcripts import"
---

<objective>
Fix test expectations to align with v1.0 PHI detection behavior

Purpose: CI tests fail because expectations don't match v1.0's intentional behavior changes. "Ronald McDonald House" is preserved (not PHI), "35 weeker" is redacted (conservative age handling).

Output: Updated sample_transcripts.py with v1.0-aligned expectations, all tests passing locally.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-cicd-fixes/09-RESEARCH.md
@tests/sample_transcripts.py
@tests/test_deidentification.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sample_transcripts.py test expectations</name>
  <files>tests/sample_transcripts.py</files>
  <action>
  Update two test expectations to match v1.0 behavior:

  1. **Transcript #2 (line 20-21)**: Add "Ronald McDonald House" to `expected_preserved` list
     - Current: `expected_preserved: ["bronchiolitis", "BPD", "FiO2", "blood gas", "high flow"]`
     - Add: "Ronald McDonald House" (v1.0 preserves it - well-known charity, not PHI)

  2. **EXPECTED_OUTPUTS[2] (line 57)**: Remove "35 weeker" from `should_contain` list
     - Current: `"should_contain": ["2 month old", "35 weeker"]`
     - Change to: `"should_contain": ["2 month old"]`
     - Reason: v1.0 redacts "35 weeker" as [AGE] (conservative gestational age handling)

  Do NOT change any other test data or expectations.
  </action>
  <verify>
  ```bash
  # Verify changes are correct
  grep -A 5 '"expected_preserved":' tests/sample_transcripts.py | head -10
  grep '"should_contain":' tests/sample_transcripts.py
  ```
  </verify>
  <done>
  - Transcript #2 `expected_preserved` includes "Ronald McDonald House"
  - EXPECTED_OUTPUTS[2]["should_contain"] does NOT include "35 weeker"
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify all tests pass locally</name>
  <files>tests/sample_transcripts.py, tests/test_deidentification.py</files>
  <action>
  Run the full test suite locally to confirm all tests pass:

  1. Run pytest on tests directory with verbose output
  2. Run the Presidio test harness (test_presidio.py)
  3. Verify zero failures

  If any tests fail, diagnose and fix the issue in sample_transcripts.py.
  </action>
  <verify>
  ```bash
  # Run full test suite
  cd "/Users/joshpankin/My Drive/10-19 Projects/12 Development & AI Projects/12.09 Pediatric_Handoff_PHI_Remover"
  pytest tests/ -v --tb=short 2>&1 | tail -30

  # Run Presidio tests
  python test_presidio.py 2>&1 | tail -10
  ```
  </verify>
  <done>
  - `pytest tests/` shows 0 failures
  - `python test_presidio.py` shows all tests passing
  </done>
</task>

<task type="auto">
  <name>Task 3: Commit requirements-dev.txt and test fixes</name>
  <files>requirements-dev.txt, tests/sample_transcripts.py</files>
  <action>
  Commit both files for CI reproducibility:

  1. Stage requirements-dev.txt (currently untracked but needed by CI)
  2. Stage tests/sample_transcripts.py (test expectation fixes)
  3. Create commit with descriptive message

  Commit message should explain WHY expectations changed (v1.0 behavior alignment).
  </action>
  <verify>
  ```bash
  git status
  git log -1 --oneline
  ```
  </verify>
  <done>
  - Both files committed
  - Commit message references v1.0 behavior alignment
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `git status` shows clean working tree (no uncommitted changes)
2. `pytest tests/ -v` shows all tests passing
3. Local environment matches what CI will see
</verification>

<success_criteria>
- [ ] sample_transcripts.py updated with v1.0-aligned expectations
- [ ] "Ronald McDonald House" in expected_preserved for transcript #2
- [ ] "35 weeker" removed from should_contain for EXPECTED_OUTPUTS[2]
- [ ] pytest tests/ passes with 0 failures
- [ ] test_presidio.py passes
- [ ] requirements-dev.txt committed
- [ ] Changes committed with descriptive message
</success_criteria>

<output>
After completion, create `.planning/phases/09-cicd-fixes/09-01-SUMMARY.md`
</output>
