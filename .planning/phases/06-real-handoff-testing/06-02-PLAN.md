---
phase: 06-real-handoff-testing
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - .planning/phases/06-real-handoff-testing/REAL_HANDOFF_VALIDATION.md
  - .planning/phases/06-real-handoff-testing/patterns_identified.md
  - app/config.py (if fixes needed)
autonomous: false

must_haves:
  truths:
    - "Error patterns from Session 1 have been analyzed"
    - "Configuration fixes applied if needed"
    - "User has completed Session 2 validation (5+ additional handoffs)"
    - "Final verdict rendered: approved or requires improvement"
  artifacts:
    - path: ".planning/phases/06-real-handoff-testing/patterns_identified.md"
      provides: "Qualitative error pattern analysis"
      contains: "Pattern"
    - path: ".planning/phases/06-real-handoff-testing/REAL_HANDOFF_VALIDATION.md"
      provides: "Complete validation results"
      contains: "Final Verdict"
  key_links:
    - from: "patterns_identified.md"
      to: "REAL_HANDOFF_VALIDATION.md"
      via: "Patterns inform final verdict"
      pattern: "Pattern|Verdict"
---

<objective>
Analyze patterns from Session 1, apply fixes if needed, conduct final validation session, and render production readiness verdict.

Purpose: Complete external validation (VALD-01) and error analysis (VALD-02). If Session 1 revealed issues, apply targeted fixes. Session 2 validates fixes don't introduce regressions and confirms production readiness.

Output: Complete validation document with final verdict, pattern analysis, and production readiness decision.
</objective>

<execution_context>
@/Users/joshpankin/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joshpankin/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-real-handoff-testing/06-RESEARCH.md
@.planning/phases/06-real-handoff-testing/06-01-SUMMARY.md
@.planning/phases/06-real-handoff-testing/REAL_HANDOFF_VALIDATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Analyze Session 1 patterns and create pattern document</name>
  <files>
    .planning/phases/06-real-handoff-testing/patterns_identified.md
    .planning/phases/06-real-handoff-testing/REAL_HANDOFF_VALIDATION.md
  </files>
  <action>
Review REAL_HANDOFF_VALIDATION.md Session 1 results and create patterns_identified.md:

**If errors were found:**
1. Group errors by entity type (PERSON, PHONE, DATE_TIME, ROOM, etc.)
2. Identify linguistic patterns (e.g., "phone numbers after possessive 'mom's'")
3. Check if errors are already in known limitations (LOCATION, low-weight entities)
4. Categorize root cause: deny list gap vs NER limitation vs threshold issue vs pattern missing
5. Prioritize by severity and fixability

**If no errors found:**
1. Document "No patterns identified - system performed as expected"
2. Note any near-misses or suspicious outputs
3. Confirm coverage met diversity targets

**patterns_identified.md structure:**
```markdown
# Pattern Analysis: Session 1

**Date:** [date]
**Handoffs analyzed:** [N]
**Total errors:** [M]

## Error Distribution

| Entity Type | Count | Severity | Fixable? |
|-------------|-------|----------|----------|
| [type] | [N] | [High/Med/Low] | [Yes/No/Defer] |

## Pattern Descriptions

### Pattern 1: [Description]
- **Examples:** [describe generically, NO real PHI]
- **Root cause:** [deny list | NER | pattern | threshold]
- **Recommended fix:** [specific action]
- **Priority:** [P1-Critical | P2-High | P3-Medium | P4-Low]

## Recommendations

[Ordered list of fixes to apply before Session 2, or "No fixes needed"]
```
  </action>
  <verify>
patterns_identified.md exists with error distribution table and pattern descriptions (or "no patterns" statement):
grep -E "Pattern|No patterns" patterns_identified.md
  </verify>
  <done>
Pattern analysis complete. Recommendations clear for next task.
  </done>
</task>

<task type="checkpoint:decision" gate="blocking">
  <name>Task 2: Decision - Apply fixes or proceed to Session 2</name>
  <decision>
Based on Session 1 patterns, decide whether to apply configuration fixes before Session 2.
  </decision>
  <context>
Pattern analysis in patterns_identified.md identifies any systemic issues.

Options depend on what was found:
- If zero errors: Skip directly to Session 2
- If errors found but not fixable (NER limitation): Accept and proceed
- If errors fixable (deny list, pattern): Apply fixes then Session 2
  </context>
  <options>
    <option id="option-a">
      <name>No fixes needed - proceed to Session 2</name>
      <pros>Faster; Session 1 validated system works</pros>
      <cons>May miss opportunity to improve</cons>
    </option>
    <option id="option-b">
      <name>Apply fixes - then Session 2</name>
      <pros>Address issues before final validation</pros>
      <cons>Requires code changes; may introduce regressions</cons>
    </option>
    <option id="option-c">
      <name>Accept limitations - document and proceed</name>
      <pros>Realistic; matches Phase 5 approach (accept known limitations)</pros>
      <cons>Errors remain but documented</cons>
    </option>
  </options>
  <resume-signal>
Select: option-a (no fixes), option-b (apply fixes), or option-c (accept limitations)
  </resume-signal>
</task>

<task type="auto">
  <name>Task 3: Apply configuration fixes (if option-b selected)</name>
  <files>
    app/config.py
  </files>
  <action>
**Skip this task if option-a or option-c was selected.**

If option-b was selected:
1. Read patterns_identified.md for recommended fixes
2. Apply deny list additions or pattern updates to app/config.py
3. Restart the application to pick up changes
4. Test one prior handoff to verify fix works without regression

Document changes made in REAL_HANDOFF_VALIDATION.md:
```markdown
## Configuration Changes (Session 1 -> Session 2)

| Change | File | Rationale |
|--------|------|-----------|
| [description] | config.py | [from pattern analysis] |
```

Commit changes: `fix(06-02): [description of fix]`
  </action>
  <verify>
If fixes applied:
- git diff app/config.py shows changes
- Application restarted successfully
- One prior handoff re-tested without regression

If no fixes needed: Skip verification
  </verify>
  <done>
Configuration fixes applied and verified (or skipped per decision).
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 4: Final testing session - 5+ additional handoffs</name>
  <action>
User conducts final validation session.

**What you'll do:**
1. Test 5+ NEW handoffs (different from Session 1)
2. If fixes were applied (option-b): Also re-test 2-3 Session 1 handoffs for regression
3. Document results in REAL_HANDOFF_VALIDATION.md under "Session 2"

**Diversity:** Continue targeting mix of ages, units, complexity

**Success threshold (from research):**
- Zero high-severity PHI leaks (patient names, MRNs visible)
- Up to 2-3 low-severity over-redactions acceptable if clinical utility preserved
- User confidence in system for personal use

**For each handoff, add to Session 2 table:**
- Sample #: continuing from Session 1 (6, 7, 8...)
- Patient context (de-identified)
- Unit
- Errors: Count or "None"
  </action>
  <how-to-verify>
After testing 5+ additional handoffs:
1. REAL_HANDOFF_VALIDATION.md has Session 2 entries
2. Total handoffs tested >= 10 (Sessions 1 + 2 combined)
3. If regressions found, note them

When complete, type: "Session 2 complete: [N] new handoffs, [M] errors, [regression status]"
  </how-to-verify>
  <resume-signal>
Type "Session 2 complete: [N] handoffs, [M] errors, [regression status]" when done
  </resume-signal>
</task>

<task type="auto">
  <name>Task 5: Render final verdict and complete validation</name>
  <files>
    .planning/phases/06-real-handoff-testing/REAL_HANDOFF_VALIDATION.md
    .planning/phases/06-real-handoff-testing/patterns_identified.md
  </files>
  <action>
Complete the validation document with final verdict:

**1. Update patterns_identified.md** with Session 2 findings:
- Were Session 1 patterns confirmed or new patterns found?
- Were fixes effective (if applied)?
- Any regressions?

**2. Add Final Verdict section to REAL_HANDOFF_VALIDATION.md:**
```markdown
## Final Verdict

**Testing Summary:**
- Total handoffs tested: [N]
- Total errors: [M]
- High-severity PHI leaks: [count]
- Over-redaction instances: [count]

**Verdict:** [APPROVED FOR PRODUCTION | REQUIRES IMPROVEMENT]

### [If APPROVED]
The Pediatric Handoff PHI Remover has been validated on real clinical handoff content:
- Zero high-severity PHI leaks in final validation
- Clinical utility preserved (timeline, ages, context readable)
- User confident in system for personal clinical use
- Ready for production use

### [If REQUIRES IMPROVEMENT]
The system requires the following before production use:
- [List specific issues]
- [Recommended next steps]

**Sign-off:**
- Tester: [name]
- Date: [date]
- System version: post-Phase 6
```

**3. Link back to expert review:** Note that Phase 5 expert review (EXPERT_REVIEW.md) approved system for personal use on synthetic data; Phase 6 confirms on real handoffs.
  </action>
  <verify>
REAL_HANDOFF_VALIDATION.md contains:
- grep "Final Verdict" REAL_HANDOFF_VALIDATION.md
- grep -E "APPROVED|REQUIRES" REAL_HANDOFF_VALIDATION.md
- grep "Sign-off" REAL_HANDOFF_VALIDATION.md
  </verify>
  <done>
Final verdict rendered. Phase 6 validation complete.
  </done>
</task>

</tasks>

<verification>
Plan 06-02 complete when:
- [ ] Pattern analysis documented (patterns_identified.md)
- [ ] Decision made on fixes (option-a/b/c)
- [ ] Fixes applied if needed
- [ ] Session 2 completed with 5+ handoffs
- [ ] Total handoffs >= 10 across both sessions
- [ ] Final verdict rendered (APPROVED or REQUIRES IMPROVEMENT)
- [ ] Sign-off documented
</verification>

<success_criteria>
1. patterns_identified.md documents error analysis from Session 1
2. REAL_HANDOFF_VALIDATION.md contains both sessions' data
3. Final verdict section present with clear APPROVED/REQUIRES status
4. If APPROVED: Zero high-severity PHI leaks in Session 2
5. If REQUIRES: Clear next steps documented
</success_criteria>

<output>
After completion, create `.planning/phases/06-real-handoff-testing/06-02-SUMMARY.md`
</output>
