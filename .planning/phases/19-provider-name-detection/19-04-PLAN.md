---
phase: 19-provider-name-detection
plan: 04
type: execute
wave: 4
depends_on: ["19-01", "19-02", "19-03"]
files_modified:
  - .planning/STATE.md
  - .planning/ROADMAP.md
autonomous: true

must_haves:
  truths:
    - All provider pattern tests pass (10+ test cases)
    - No regression on existing tests (GUARDIAN_NAME, ROOM, etc.)
    - Full test suite passes (pytest tests/ -v)
    - PROVIDER_NAME patterns documented in STATE.md
  artifacts:
    - path: ".planning/STATE.md"
      provides: "Updated state with Phase 19 completion"
      contains: "Phase 19"
    - path: ".planning/ROADMAP.md"
      provides: "Updated roadmap with Phase 19 checkboxes"
      contains: "19-04-PLAN.md"
  key_links:
    - from: ".planning/STATE.md"
      to: "app/recognizers/provider.py"
      via: "documents pattern count"
      pattern: "provider patterns"
---

<objective>
Validate all provider name patterns work correctly and measure improvement. Update project state and roadmap.

Purpose: Confirm Phase 19 implementation is complete and document the results. Validate that provider name detection improves PERSON recall without introducing regressions.

Output: All tests passing, STATE.md updated with Phase 19 completion, ROADMAP.md updated with plan checkboxes.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/19-provider-name-detection/19-01-SUMMARY.md
@.planning/phases/19-provider-name-detection/19-02-SUMMARY.md
@.planning/phases/19-provider-name-detection/19-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run full validation suite</name>
  <files></files>
  <action>
Run comprehensive validation:

1. Run Presidio test harness:
   ```bash
   python test_presidio.py
   ```
   Capture: Total tests, passed, failed, known issues

2. Run pytest unit tests:
   ```bash
   pytest tests/ -v -k "not integration" --tb=short
   ```
   Capture: Total tests, passed, failed, xfailed

3. Count provider patterns:
   ```bash
   python -c "from app.recognizers.provider import get_provider_recognizers; patterns = [p for r in get_provider_recognizers() for p in r.patterns]; print(f'Total provider patterns: {len(patterns)}')"
   ```

4. Verify PROVIDER_NAME detection:
   ```bash
   python -c "
from app.deidentification import deidentify_text
tests = [
    'Dr. Smith is on service.',
    'Spoke with Dr. Martinez about labs.',
    'His nurse Sarah gave meds.',
    'The attending is Rodriguez.',
]
for t in tests:
    r = deidentify_text(t)
    print(f'{t!r} -> {r.clean_text!r}')
    "
   ```

Document all results for summary.
  </action>
  <verify>python test_presidio.py 2>&1 | tail -5</verify>
  <done>All tests pass, validation results captured</done>
</task>

<task type="auto">
  <name>Task 2: Update STATE.md</name>
  <files>.planning/STATE.md</files>
  <action>
Update STATE.md with Phase 19 completion:

1. Update "Current Position" section:
   - Phase: 19 of 22 (Provider Name Detection) - COMPLETE
   - Plan: 4 of 4 (all plans completed)
   - Status: v2.3 in progress, Phase 19 complete (XX provider patterns)
   - Last activity: current date - Completed 19-04-PLAN.md

2. Update "v2.3 Roadmap Overview":
   - Phase 19: Provider Name Detection (XX patterns) - COMPLETE (4/4 plans)

3. Add to "Accumulated Context > Decisions":
   - PROVIDER-PATTERN-ARCHITECTURE (Phase 19): Follow Phase 18 Guardian patterns with lookbehind, 0.85 score for role context, 0.80 for action context
   - PROVIDER-DENY-LIST (Phase 19): Comprehensive deny list prevents flagging generic role references

4. Update "Pending Todos":
   - Remove: "Plan Phase 19 (Provider Name Detection)"
   - Keep remaining Phase 20-22 items

5. Update "Session Continuity":
   - Last session: current date
   - Stopped at: Completed Phase 19 - Provider Name Detection
   - Next: Phase 20 (Phone/Pager), Phase 21 (Location), or Phase 22 (Validation)
  </action>
  <verify>grep -A2 "Phase 19" .planning/STATE.md</verify>
  <done>STATE.md updated with Phase 19 completion</done>
</task>

<task type="auto">
  <name>Task 3: Update ROADMAP.md</name>
  <files>.planning/ROADMAP.md</files>
  <action>
Update ROADMAP.md Phase 19 section:

1. Update "Phase 19: Provider Name Detection":
   - **Plans**: 4 plans
   - Update success criteria with checkmarks
   - Add plan list:
   ```
   Plans:
   - [x] 19-01-PLAN.md - Title-prefixed patterns (Dr., NP, PA, RN)
   - [x] 19-02-PLAN.md - Role context patterns (attending, nurse, fellow)
   - [x] 19-03-PLAN.md - Action context patterns (paged, called, spoke with)
   - [x] 19-04-PLAN.md - Validation and documentation
   ```

2. Update Progress table:
   - Phase 19 row: Plans Complete = 4/4, Status = Complete, Completed = current date

3. Add achieved metrics if available from validation
  </action>
  <verify>grep -A10 "Phase 19:" .planning/ROADMAP.md | head -15</verify>
  <done>ROADMAP.md updated with Phase 19 completion</done>
</task>

</tasks>

<verification>
1. All provider pattern tests pass: `python test_presidio.py` shows no failures in provider tests
2. Full test suite passes: `pytest tests/ -v -k "not integration"` exits 0
3. STATE.md shows Phase 19 complete
4. ROADMAP.md shows 4/4 plans complete for Phase 19
5. No regressions on existing entity types
</verification>

<success_criteria>
- [ ] test_presidio.py passes all provider tests (10+ tests)
- [ ] pytest tests/ passes (no regressions)
- [ ] Provider pattern count documented (50+ patterns expected)
- [ ] STATE.md updated with Phase 19 completion
- [ ] ROADMAP.md updated with Phase 19 plan checkboxes
- [ ] Decisions documented in STATE.md
</success_criteria>

<output>
After completion, create `.planning/phases/19-provider-name-detection/19-04-SUMMARY.md`
</output>
