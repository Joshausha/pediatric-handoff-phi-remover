# Milestone v2.2: Dual-Weight Recall Framework

**Status:** ✅ SHIPPED 2026-01-30
**Phases:** 13-16
**Total Plans:** 5

## Overview

Implement three-metric recall evaluation separating frequency (spoken prevalence) from risk (leak severity) for spoken handoffs. Delivers unified reporting table with divergence indicators, side-by-side weight comparison, and CI enforcement of 85% unweighted recall floor.

## Phases

### Phase 13: Test Suite Migration

**Goal**: Complete test coverage for float weights and risk-weighted metrics
**Depends on**: Nothing (research complete, partial implementation in working tree)
**Plans**: 1 plan

Plans:
- [x] 13-01: Fix float assertions, add risk-weighted tests, add divergence validation

**Details:**
- Migrated weighted metrics tests from int to float
- Added TestRiskWeightedMetrics class (5 tests)
- Added TestWeightDivergence class (4 tests)
- Total test coverage: 11 → 20 tests, all passing in 0.21s

**Key decisions:**
- Use pytest.approx() for all float weight comparisons
- Add explicit tests for frequency vs risk weight divergence (core value proposition)

### Phase 14: Report Generation Refinement

**Goal**: Polish three-metric report display with clear explanations
**Depends on**: Phase 13 (validated calculations)
**Plans**: 1 plan

Plans:
- [x] 14-01: Three-metric summary table, side-by-side weights, divergence explanation

**Details:**
- Unified three-metric summary table (Unweighted, Frequency-weighted, Risk-weighted)
- Side-by-side weight comparison tables with divergence markers (asterisk for >2.0 divergence)
- Zero-weight entity explanatory notes for EMAIL_ADDRESS and PEDIATRIC_AGE
- Concrete MRN divergence example explaining why metrics differ

**Key decisions:**
- Inline "Safety Floor" annotation with unweighted row (not separate note)
- Side-by-side tables show both frequency-sorted and risk-sorted columns
- Hardcoded MRN example explains design rationale (not dynamic data)

### Phase 15: Documentation Updates

**Goal**: Document dual-weighting rationale and usage guidance
**Depends on**: Phase 14 (finalized report format)
**Plans**: 1 plan

Plans:
- [x] 15-01: Add dual-weighting methodology section, update PROJECT.md

**Details:**
- Added "Dual-Weighting Methodology" section to SPOKEN_HANDOFF_ANALYSIS.md
- Documented frequency weight purpose (operational reality - spoken prevalence)
- Documented risk weight purpose (HIPAA compliance - leak severity)
- Updated PROJECT.md with v2.2 completion status
- Added dual-weighting decision to Key Decisions table

### Phase 16: Integration Validation

**Goal**: End-to-end validation with regression baselines established
**Depends on**: Phase 13, Phase 14, Phase 15
**Plans**: 2 plans

Plans:
- [x] 16-01: Integration test infrastructure, regression baselines, tiered CI
- [x] 16-02: Metric comparison charts, v2.2 completion verification

**Details:**
- Extended run_validation() to return weighted metrics (6 total)
- Created integration test suite with 6 tests validating three metric types
- Committed regression baseline with all metrics
- Updated CI workflow with tiered integration tests (smoke on PRs, full on main)
- Created metric comparison chart generator for visual validation
- Verified all 20/20 v2.2 requirements complete

**Key decisions:**
- Simple JSON baselines over pytest-regressions (fewer dependencies)
- Module-scoped fixtures for efficiency (run validation once per file)
- 1% relative tolerance for float comparisons
- Tiered CI: smoke tests catch recall floor violations immediately

---

## Milestone Summary

**Key Decisions:**

| Decision | Rationale | Outcome |
|----------|-----------|---------|
| Dual-weighting (frequency + risk) | Frequency measures spoken prevalence; risk measures leak severity; both needed for complete evaluation | ✓ Good |
| Float weights (int→float) | Finer granularity for low-frequency entities (0.5 weights) | ✓ Good |
| Three-metric reporting | Always show unweighted as HIPAA safety floor alongside weighted schemes | ✓ Good |
| JSON baselines | Fewer dependencies, explicit control, easier for medical domain users | ✓ Good |
| Tiered CI workflow | Balance thoroughness with CI speed | ✓ Good |
| 85% recall floor enforcement | HIPAA safety requirement cannot be compromised | ✓ Good |

**Issues Resolved:**

- Missing risk-weighted metric tests
- Int-to-float migration for weight configuration
- Scattered metric display (unified into single summary table)
- Lack of divergence explanation (added MRN example)
- No integration test infrastructure (created complete suite)

**Issues Deferred:**

None - all v2.2 requirements delivered.

**Technical Debt Incurred:**

None - all implementation complete with proper test coverage.

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-01-30 as part of v2.2 milestone completion*
